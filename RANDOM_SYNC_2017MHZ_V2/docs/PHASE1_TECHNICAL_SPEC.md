# Техническое задание фазы 1: Базовая архитектура и прототип

## 1. Обзор проекта

**Название проекта:** RANDOM_SYNC_2017MHZ_V2
**Цель:** Разработка оборудования ретрансляции фазовой синхронизации по радиолинии на частоте 2017 МГц (LTE Band 34, TDD) с использованием гибридной архитектуры WiWi + AD9361

**Фаза 1:** Создание базовой архитектуры и прототипа с поддержкой целевой частоты и базовой синхронизацией

## 2. Технические требования

### 2.1 Базовые требования
- **Целевая частота:** 2017 МГц (LTE Band 34, TDD)
- **Точность синхронизации:** Не хуже ±1 мкс в стационарном режиме
- **Протокол синхронизации:** PTP (IEEE 1588) с поддержкой G.8275.1
- **Архитектура:** Master/Slave модули

### 2.2 Аппаратные требования
- **Основной контроллер:** STM32H7 (480 МГц, 2 МБ Flash, 1 МБ SRAM)
- **Радиотрансивер:** AD9361 (70 МГц - 6 ГГц)
- **FPGA:** ECP5 (для цифровой обработки сигналов)
- **Генератор частоты:** OCXO ±0.05 ppm стабильность
- **GNSS приемник:** Многосистемный (GPS, GLONASS, Galileo, BeiDou)

### 2.3 Интерфейсы
- **Радиоинтерфейс:** SMA разъемы для антенн
- **Сетевые интерфейсы:** 3x SFP/SFP+ порта для PTP
- **Управление:** Ethernet RJ-45 + USB
- **Синхронизация:** SMA вход для GNSS антенны
- **Питание:** -48V DC с защитой от переполюсовки

### 2.4 Программные требования
- **ОС:** FreeRTOS для STM32H7
- **PTP стек:** linuxptp или PTPd с поддержкой hardware timestamping
- **FPGA логика:** VHDL/Verilog для обработки I/Q данных
- **Система управления:** SNMP + REST API

## 3. Архитектура системы

### 3.1 Общая архитектура
Система состоит из двух типов модулей:
- **Master модуль:** Источник синхронизации с GNSS приемником
- **Slave модули:** Приемники и ретрансляторы PTP пакетов

### 3.2 Компоненты Master модуля
- STM32H7 микроконтроллер
- AD9361 радиотрансивер
- ECP5 FPGA
- GNSS приемник (SMA вход)
- OCXO генератор частоты
- Ethernet контроллер с PTP поддержкой
- 3x SFP порта
- DC-DC преобразователи для питания

### 3.3 Компоненты Slave модуля
- STM32H7 микроконтроллер
- AD9361 радиотрансивер
- ECP5 FPGA
- OCXO генератор частоты
- Ethernet контроллер с PTP поддержкой
- 3x SFP порта
- DC-DC преобразователи для питания

## 4. Функциональные требования

### 4.1 Базовая синхронизация
- Прием GNSS сигналов для получения точного времени
- Генерация PPS сигналов для синхронизации
- Компенсация задержек распространения сигнала
- Поддержка режима Holdover при потере GNSS сигнала

### 4.2 PTP протокол
- Реализация PTP Boundary Clock согласно G.8275.1
- Hardware timestamping для всех портов
- Поддержка Delay Request-Response механизма
- Компенсация асимметрии задержек

### 4.3 Радиоинтерфейс
- Передача PTP пакетов по радиоканалу 2017 МГц
- Адаптивная модуляция и кодирование
- Поддержка TDD режима
- Автоматическая регулировка мощности

## 5. Критерии приемки фазы 1

### 5.1 Функциональные критерии
- [ ] Стабильная работа на частоте 2017 МГц
- [ ] Успешный обмен PTP пакетами между Master и Slave
- [ ] Точность синхронизации не хуже ±1 мкс
- [ ] Стабильный прием GNSS сигналов
- [ ] Функционирующий Ethernet интерфейс

### 5.2 Технические критерии
- [ ] Стабильность частоты ±0.05 ppm
- [ ] Фазовый шум радиосигнала <-120 дБс/Гц
- [ ] Чувствительность приемника лучше -100 дБм
- [ ] Выходная мощность передатчика до +20 дБм

### 5.3 Программные критерии
- [ ] Стабильная работа PTP стека
- [ ] Корректная обработка I/Q данных в FPGA
- [ ] Функционирующая система управления
- [ ] Логирование и диагностика

## 6. План тестирования

### 6.1 Лабораторное тестирование
- Тестирование базовой функциональности
- Измерение параметров радиоинтерфейса
- Тестирование PTP синхронизации
- Валидация GNSS интеграции

### 6.2 Интеграционное тестирование
- Тестирование взаимодействия Master-Slave
- Тестирование сетевых интерфейсов
- Тестирование системы управления
- Нагрузочное тестирование

### 6.3 Полевые испытания
- Тестирование в реальных условиях
- Измерение дальности связи
- Тестирование стабильности синхронизации
- Валидация электромагнитной совместимости

## 7. Риски и ограничения фазы 1

### 7.1 Технические риски
- Сложность интеграции AD9361 с существующей архитектурой WiWi
- Достижение требуемой точности синхронизации
- Стабильность работы в расширенном температурном диапазоне

### 7.2 Временные риски
- Задержки в поставке компонентов AD9361
- Сложность отладки FPGA логики
- Интеграционные проблемы с PTP стеком

### 7.3 Ресурсные ограничения
- Ограниченное количество прототипов для тестирования
- Необходимость специализированного RF оборудования
- Требуемые навыки для работы с AD9361

## 8. Метрики успеха

- **Точность синхронизации:** ±1 мкс (цель), ±500 нс (минимум)
- **Стабильность частоты:** ±0.05 ppm (цель), ±0.1 ppm (минимум)
- **Время разработки:** 8 недель (цель), 10 недель (максимум)
- **Функциональность:** 80% требований ТЗ (минимум)

## 9. Следующие фазы

После успешного завершения фазы 1 планируются:
- **Фаза 2:** Оптимизация точности до ±300 нс
- **Фаза 3:** Полная интеграция с оборудованием заказчика
- **Фаза 4:** Полевые испытания и сертификация

---

*Техническое задание создано: Январь 2025*
*Версия: 1.0*
*Статус: Активное*
