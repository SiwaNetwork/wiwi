# RCB_WWVB_LORA - Модуль синхронизации времени WWVB с LoRa сетью

## Описание

RCB_WWVB_LORA - это специализированный модуль для синхронизации времени по сигналу WWVB (60 кГц) с возможностью организации беспроводной сети на базе протокола LoRa. Модуль предназначен для создания точных временных референсов в распределенных системах.

## Основные возможности

### Синхронизация времени WWVB
- Прием сигнала WWVB на частоте 60 кГц
- Декодирование временной информации
- Синхронизация локального генератора с эталоном времени
- Генерация сигналов PPS (Pulse Per Second)

### LoRa сеть WiWi
- Организация mesh-сети устройств для синхронизации времени
- Протокол WiWi для обмена временными метками
- Автоматическое определение мастер-устройства
- Компенсация задержек передачи

### Аппаратная архитектура

#### Микроконтроллер
- **STM32H7** - высокопроизводительный ARM Cortex-M7
- Поддержка DMA для высокоскоростной обработки данных
- Множественные SPI интерфейсы для подключения периферии

#### Радиочастотные модули
- **SX1276** - LoRa трансивер для беспроводной связи
- **SX1257** - SDR приемопередатчик для работы с WWVB
- Поддержка диапазонов 868/915 МГц и 2.4 ГГц

#### FPGA обработка
- **ICE40** - FPGA для цифровой обработки сигналов
- Высокоскоростная обработка I/Q данных
- Фильтрация и детектирование сигналов WWVB

#### Генераторы частот
- **Si5341B** - высокоточный генератор частот
- **SiTime** - дополнительный генератор для стабилизации
- Программируемые PLL для различных частотных стандартов

## Структура проекта

### Основные компоненты

#### V2/RCB_WWVB/
Основной код прошивки для STM32:
- `RCB_WWVB.ino` - главный файл прошивки
- `WWVB_Arduino.h/.cpp` - низкоуровневые функции для работы с платой
- `WiWi_Network.h/.cpp` - сетевой стек протокола WiWi
- `SX1257.h/.cpp` - драйвер SDR трансивера
- `SX1276_LORA.h/.cpp` - драйвер LoRa модуля
- `ICE40.h/.cpp` - управление FPGA
- `SI5341B.h/.cpp` - управление генератором частот
- `SiTime.h/.cpp` - дополнительный генератор

#### V2/ICE40/
FPGA прошивка для ICE40:
- `8bit_counter/` - проект счетчика для обработки данных
- `source/` - исходные файлы Verilog
- `impl1/` - результаты синтеза и размещения

## Принцип работы

### Режим клиента
1. **Поиск** - отправка broadcast сообщений для поиска мастер-устройства
2. **Синхронизация** - получение временных меток от мастера
3. **Коррекция** - адаптивная подстройка локального генератора

### Режим мастера
1. **Эталон** - использование WWVB как временного эталона
2. **Распространение** - передача временных меток клиентам
3. **Мониторинг** - отслеживание состояния сети

### Протокол WiWi
- **ANNOUNCE** - анонс устройства и его статуса
- **DELAY_REQUEST** - запрос на измерение задержки
- **DELAY_RESPONSE** - ответ с временными метками
- **IQ данные** - передача фазовой информации для точной синхронизации

## Интерфейсы

### Последовательный порт
- Скорость: 9600 бод
- Поддержка команд управления
- Диагностическая информация

### LoRa интерфейс
- Частота: 868/915 МГц
- Мощность: до 20 дБм
- Дальность: до 15 км (в зависимости от условий)

### WWVB антенна
- Частота: 60 кГц
- Чувствительность: -120 дБм
- Диапазон приема: до 3000 км

## Применение

- **Телекоммуникационные системы** - синхронизация базовых станций
- **Научные эксперименты** - временная синхронизация датчиков
- **Промышленная автоматизация** - координация распределенных систем
- **Исследования** - изучение распространения радиоволн

## Технические характеристики

- **Точность синхронизации**: ±1 мкс
- **Стабильность генератора**: ±1×10⁻¹²
- **Потребление**: 2-5 Вт (в зависимости от режима)
- **Рабочая температура**: -40°C до +85°C
- **Напряжение питания**: 5-12 В

## Разработка и отладка

### Команды отладки
- `0` - запуск WiWi сети
- `u/U` - увеличение частоты (мелкие/крупные шаги)
- `d/D` - уменьшение частоты
- `T` - запуск тестовых процедур
- `&` - перезагрузка системы

### Мониторинг
- Статус DMA каналов
- Состояние PLL
- Качество сигнала WWVB
- Параметры LoRa связи

## Лицензия

Проект распространяется под лицензией, указанной в корневом каталоге репозитория.
