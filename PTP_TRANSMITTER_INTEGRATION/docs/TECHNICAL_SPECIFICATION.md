# Техническое задание: PTP Transmitter Integration

## 1. Обзор проекта

**Название проекта:** PTP_TRANSMITTER_INTEGRATION
**Цель:** Разработка оборудования для формирования и передачи PTP пакетов синхронизации на внешний радиопередатчик заказчика, работающий на частоте 2017 МГц (LTE Band 34, TDD).

**Ключевой принцип:** Оборудование подключается к внешнему радиопередатчику заказчика и формирует PTP пакеты для дальнейшей передачи по радиоканалу.

## 2. Технические требования

### 2.1 Основные требования
- **Целевая частота:** 2017 МГц (LTE Band 34, TDD)
- **Точность синхронизации:** ±300 нс (цель), ±1 мкс (фаза 1)
- **Протокол:** PTP (IEEE 1588-2008) с профилем G.8275.1
- **Архитектура:** Master/Slave модули

### 2.2 Интерфейс к внешнему радиопередатчику
- **Стандартные интерфейсы:** Ethernet, CPRI, eCPRI, оптический
- **Синхронизация передатчика:** 10 MHz + 1 PPS опорные сигналы
- **Передача данных:** PTP пакеты по выбранному интерфейсу

### 2.3 Аппаратные требования
- **Основной контроллер:** STM32H7 (480 МГц, 2 МБ Flash, 1 МБ SRAM)
- **Генератор частоты:** OCXO ±0.05 ppm стабильность
- **GNSS приемник:** Многосистемный (GPS, GLONASS, Galileo, BeiDou)
- **Ethernet контроллер:** С поддержкой hardware timestamping
- **SFP порты:** 3x SFP/SFP+ для PTP интерфейсов

### 2.4 Программные требования
- **ОС:** FreeRTOS для STM32H7
- **PTP стек:** Полная реализация G.8275.1 с hardware timestamping
- **Система управления:** SNMP + REST API + Web интерфейс
- **FPGA логика:** Обработка I/Q данных (если требуется)

## 3. Архитектура системы

### 3.1 Общая архитектура
Система состоит из модулей, которые подключаются к внешнему радиопередатчику:

```
┌─────────────────────────────────────────────────────────────────┐
│                    Master/Slave модуль                          │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐ │
│  │   GNSS      │  │   STM32H7   │  │   PTP       │  │  Sync   │ │
│  │  Антенна    │  │   Control   │  │   Former    │  │  Out-   │ │
│  │  (SMA)      │◄►│   + Logic   │◄►│   (PTP)     │◄►│  puts   │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘ │
│           │              │                 │              │       │
│           ▼              ▼                 ▼              ▼       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐ │
│  │   OCXO      │  │  Ethernet   │  │   CPRI/     │  │  10MHz  │ │
│  │  ±0.05ppm   │  │   + PTP     │  │   eCPRI     │  │  +1PPS  │ │
│  │  Generator  │◄►│   Hardware  │◄►│   Interface │◄►│  Sync   │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘ │
│           │              │                 │              │       │
│           ▼              ▼                 ▼              ▼       │
└─────────────────────────────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────┐
│                ВНЕШНИЙ РАДИОПЕРЕДАТЧИК ЗАКАЗЧИКА               │
│                     (2017 МГц, LTE Band 34)                     │
├─────────────────────────────────────────────────────────────────┤
│  Синхронизируется с нашим OCXO по 10MHz + 1PPS сигналам        │
│  Получает PTP пакеты через Ethernet/CPRI/eCPRI интерфейс       │
│  Передает синхронизированные данные по радиоканалу            │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 Компоненты Master модуля
- **STM32H7** - Основной контроллер с PTP стеком
- **GNSS приемник** - SMA вход для антенны
- **OCXO генератор** - ±0.05 ppm стабильность
- **Ethernet контроллер** - С hardware timestamping
- **SFP порты** - 3x для PTP интерфейсов
- **Интерфейсы к передатчику** - Ethernet, CPRI, eCPRI, оптический
- **SMA выходы** - 10 MHz + 1 PPS для синхронизации передатчика

### 3.3 Компоненты Slave модуля
- **STM32H7** - Основной контроллер с PTP стеком
- **OCXO генератор** - ±0.05 ppm стабильность
- **Ethernet контроллер** - С hardware timestamping
- **SFP порты** - 3x для PTP интерфейсов
- **Интерфейсы к передатчику** - Ethernet, CPRI, eCPRI, оптический

## 4. Функциональные требования

### 4.1 Формирование PTP пакетов
- **PTP Boundary Clock** согласно G.8275.1
- **Hardware timestamping** на всех интерфейсах
- **Компенсация задержек** в сети
- **Адаптивные алгоритмы** синхронизации

### 4.2 Интеграция с передатчиком
- **Протоколы передачи:** PTP over Ethernet, CPRI, eCPRI
- **Синхронизация частоты:** 10 MHz опорный сигнал
- **Синхронизация времени:** 1 PPS сигнал
- **Автоматическое обнаружение** подключенного передатчика

### 4.3 GNSS синхронизация
- **Многосистемная поддержка:** GPS, GLONASS, Galileo, BeiDou
- **Автоматический выбор** лучшего сигнала
- **Режим Holdover** при потере сигнала
- **Точность:** ±100 нс к UTC

## 5. Интерфейсы

### 5.1 Интерфейс к внешнему передатчику
| Интерфейс | Назначение | Протокол |
|-----------|------------|----------|
| **Ethernet** | Передача PTP пакетов | PTP over UDP/IP |
| **CPRI** | Интеграция с оборудованием LTE | CPRI с PTP |
| **eCPRI** | Улучшенная интеграция | eCPRI с PTP |
| **Оптический** | Удаленное подключение | PTP over optical |

### 5.2 Синхронизация передатчика
| Сигнал | Назначение | Параметры |
|--------|------------|-----------|
| **10 MHz** | Опорная частота | 10 MHz ±0.05 ppm, 50 Ом |
| **1 PPS** | Временная синхронизация | 1 PPS, TTL уровень |

### 5.3 Системные интерфейсы
| Интерфейс | Назначение | Параметры |
|-----------|------------|-----------|
| **SMA GNSS** | Подключение GNSS антенны | 50 Ом, 3-5V DC |
| **SFP порты** | PTP интерфейсы | 3x SFP/SFP+ |
| **Ethernet** | Управление и мониторинг | 1000Base-T |
| **USB** | Отладка и обновление | USB 2.0 |

## 6. Программное обеспечение

### 6.1 Архитектура ПО
```
┌─────────────────────────────────────────────────────────┐
│                    Прикладной уровень                    │
├─────────────────────────────────────────────────────────┤
│  REST API │ SNMP │ PTP Application │ Sync Management   │
├─────────────────────────────────────────────────────────┤
│                    Транспортный уровень                   │
├─────────────────────────────────────────────────────────┤
│  UDP/IP │ PTP Protocol │ Transmitter Interface │ SyncE   │
├─────────────────────────────────────────────────────────┤
│                     Аппаратный уровень                    │
├─────────────────────────────────────────────────────────┤
│  STM32H7 HAL │ Ethernet Drivers │ GPIO Control │ UART    │
└─────────────────────────────────────────────────────────┘
```

### 6.2 Ключевые модули
- **PTP Engine** - Полная реализация G.8275.1
- **Transmitter Interface** - Драйверы для подключения к передатчику
- **Sync Manager** - Управление синхронизацией
- **GNSS Handler** - Обработка GNSS данных
- **Management Interface** - SNMP + REST API

## 7. Критерии приемки

### 7.1 Функциональные критерии
- [ ] Стабильная работа с внешним передатчиком
- [ ] Точность синхронизации не хуже ±1 мкс
- [ ] Успешный обмен PTP пакетами
- [ ] Стабильный прием GNSS сигналов

### 7.2 Технические критерии
- [ ] Стабильность частоты ±0.05 ppm
- [ ] Чувствительность GNSS -165 дБм
- [ ] Hardware timestamping на всех интерфейсах
- [ ] Поддержка всех указанных интерфейсов

### 7.3 Программные критерии
- [ ] Стабильная работа PTP стека
- [ ] Корректная обработка всех сообщений PTP
- [ ] Функционирующая система управления
- [ ] Логирование и диагностика

## 8. План разработки

### Фаза 1: Базовая интеграция (8 недель)
- Создание базовой архитектуры
- Реализация PTP стека
- Интеграция с GNSS
- Тестирование с внешним передатчиком

### Фаза 2: Оптимизация (6 недель)
- Достижение целевой точности ±300 нс
- Оптимизация алгоритмов
- Тестирование стабильности

### Фаза 3: Полная интеграция (4 недели)
- Интеграция с оборудованием заказчика
- Финальное тестирование
- Подготовка к производству

## 9. Риски и ограничения

### Технические риски
- Сложность интеграции с различными типами передатчиков
- Достижение требуемой точности синхронизации
- Стабильность работы в промышленных условиях

### Временные риски
- Зависимость от спецификаций внешнего передатчика
- Необходимость адаптации под конкретное оборудование заказчика

---

*Техническое задание создано: Январь 2025*
*Версия: 1.0*
*Статус: Активное*
